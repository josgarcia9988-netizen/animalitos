<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéØ Animalitos Predictor</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            font-size: 14px;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 10px;
        }

        .header {
            text-align: center;
            margin-bottom: 15px;
            color: white;
        }

        .header h1 {
            font-size: 1.8rem;
            margin-bottom: 5px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .stats-row {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 15px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            padding: 12px 8px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }

        .stat-card i {
            font-size: 1.2rem;
            margin-bottom: 5px;
            color: #667eea;
        }

        .stat-card h3 {
            font-size: 1.1rem;
            margin-bottom: 2px;
            color: #333;
            transition: all 0.3s ease;
        }
        
        .stat-card h3.updating {
            color: #ffc107 !important;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .stat-card p {
            color: #666;
            font-size: 0.7rem;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
            min-width: 100px;
            justify-content: center;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .btn-success {
            background: linear-gradient(45deg, #56ab2f, #a8e6cf);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(45deg, #ff416c, #ff4b2b);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 15px;
            backdrop-filter: blur(10px);
        }

        .section-title {
            font-size: 1.2rem;
            margin-bottom: 12px;
            color: #333;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

                 .results-grid {
             display: grid;
             grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
             gap: 8px;
         }

                 .result-card {
             background: #f8f9fa;
             border-radius: 6px;
             padding: 8px 6px;
             text-align: center;
             border-left: 3px solid #667eea;
             transition: all 0.3s ease;
             position: relative;
             overflow: hidden;
             min-height: 65px;
         }

        .result-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            opacity: 0.1;
            z-index: 0;
        }

        .result-card > * {
            position: relative;
            z-index: 1;
        }

        .bg-red::before {
            background: linear-gradient(45deg, #dc3545, #ff6b6b);
        }

        .bg-black::before {
            background: linear-gradient(45deg, #343a40, #495057);
        }

        .bg-green::before {
            background: linear-gradient(45deg, #28a745, #51cf66);
        }

        .temperature-indicator {
            position: absolute;
            top: 3px;
            right: 3px;
            font-size: 1rem;
            z-index: 2;
        }

        .temperature-hot {
            color: #dc3545;
            text-shadow: 0 0 3px rgba(220, 53, 69, 0.5);
        }

        .temperature-warm {
            color: #fd7e14;
            text-shadow: 0 0 3px rgba(253, 126, 20, 0.5);
        }

        .temperature-cold {
            color: #17a2b8;
            text-shadow: 0 0 3px rgba(23, 162, 184, 0.5);
        }

        .result-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

                 .result-number {
             font-size: 1.1rem;
             font-weight: bold;
             margin-bottom: 2px;
         }

                 .result-animal {
             font-size: 0.8rem;
             margin-bottom: 2px;
             color: #333;
             font-weight: 500;
         }

                 .result-time {
             font-size: 0.7rem;
             color: #666;
         }

        .color-red {
            border-left-color: #dc3545;
        }

        .color-black {
            border-left-color: #343a40;
        }

        .color-green {
            border-left-color: #28a745;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .loading i {
            font-size: 1.5rem;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            text-align: center;
            font-size: 0.8rem;
        }

        .success {
            background: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            text-align: center;
            font-size: 0.8rem;
        }

        .analysis-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .analysis-card {
            padding: 10px;
            border-radius: 8px;
            border-left: 3px solid;
        }

        .analysis-card h3 {
            font-size: 0.9rem;
            margin-bottom: 5px;
            color: #333;
        }

        .analysis-card p {
            font-size: 0.75rem;
            margin: 2px 0;
            color: #666;
        }

        .color-prediction {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: #d4edda;
            border-radius: 8px;
            border-left: 3px solid #28a745;
        }

        .color-prediction span {
            font-size: 1.5rem;
        }

        .color-prediction div p {
            margin: 0;
            font-size: 0.8rem;
        }

        .color-prediction div p:first-child {
            font-weight: bold;
            color: #28a745;
        }

        .temperature-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }

        .temp-stat {
            text-align: center;
            padding: 8px;
            border-radius: 6px;
            font-size: 0.75rem;
        }

        .temp-stat.hot {
            background: #ffe6e6;
            color: #dc3545;
        }

        .temp-stat.warm {
            background: #fff3cd;
            color: #fd7e14;
        }

        .temp-stat.cold {
            background: #e6f3ff;
            color: #17a2b8;
        }

        /* Estilos para el modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }

        /* Modal del animal con mayor prioridad */
        #animalModal {
            z-index: 2000;
        }

        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 0;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            animation: modalSlideIn 0.3s ease-out;
            position: relative;
        }

        /* Modal de temperatura espec√≠fico */
        #temperatureModal .modal-content {
            max-width: 800px;
            max-height: 85vh;
            background-color: #fefefe;
        }

        #temperatureModal .modal-body {
            padding: 20px;
            max-height: 65vh;
            overflow-y: auto;
            background-color: #fefefe;
        }

        /* Grid eliminado - ahora usa estilos inline */

        /* Asegurar que el contenido sea visible */
        #temperatureModal .modal-content,
        #temperatureModal .modal-body,
        #temperatureModal #modalContent {
            background-color: #fefefe !important;
            color: #333 !important;
        }

        /* ESTILOS LIMPIOS para el modal de temperatura */

        /* Estilos de tarjetas eliminados - ahora usa estilos inline */

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .close {
            color: white;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .close:hover {
            transform: scale(1.1);
            opacity: 0.8;
        }

        .modal-body {
            padding: 20px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .modal-animals-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
        }

        .modal-animal-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 12px;
            text-align: center;
            border-left: 4px solid;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .modal-animal-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .modal-animal-card.color-red {
            border-left-color: #dc3545;
        }

        .modal-animal-card.color-black {
            border-left-color: #343a40;
        }

        .modal-animal-card.color-green {
            border-left-color: #28a745;
        }

        .modal-animal-number {
            font-size: 1.2rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 4px;
        }

        .modal-animal-name {
            font-size: 0.8rem;
            color: #666;
            margin-bottom: 4px;
            font-weight: 500;
        }

        .modal-animal-count {
            font-size: 0.7rem;
            color: #28a745;
            font-weight: bold;
            margin-bottom: 4px;
        }

        .modal-animal-color {
            font-size: 1.2rem;
            margin-top: 4px;
        }

        .modal-animal-score {
            font-size: 0.7rem;
            color: #007bff;
            font-weight: bold;
            margin-bottom: 4px;
        }

        /* Estilos para los botones de color */
        .alternative-buttons {
            margin-top: 15px;
            text-align: center;
        }

        .btn {
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0 5px;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .btn-black {
            background: #343a40;
            color: white;
        }

        .btn-black:hover {
            background: #23272b;
        }

        .btn-red {
            background: #dc3545;
            color: white;
        }

        .btn-red:hover {
            background: #c82333;
        }

        /* Responsive para el modal */
        @media (max-width: 768px) {
            .modal-content {
                width: 95%;
                margin: 10% auto;
            }
            
            .modal-animals-grid {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
                gap: 8px;
            }
            
            .modal-animal-card {
                padding: 8px;
            }
            
            .modal-animal-number {
                font-size: 1rem;
            }
            
            .modal-animal-name {
                font-size: 0.7rem;
            }

            /* Responsive para temperatura eliminado - usa estilos inline */
        }

        /* Estilos para el modal de estad√≠sticas */
        .stats-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .stats-section h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .stat-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-left: 4px solid #007bff;
        }

        .stat-card.success {
            border-left-color: #28a745;
        }

        .stat-card.warning {
            border-left-color: #ffc107;
        }

        .stat-card.primary {
            border-left-color: #007bff;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #666;
            font-weight: 500;
        }

        .period-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .period-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .period-card h4 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .period-data {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .period-data span {
            font-size: 0.9rem;
            color: #666;
        }

        .top-animals {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .animal-stat-row {
            display: grid;
            grid-template-columns: 50px 1fr 100px 100px;
            gap: 15px;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }

        .animal-stat-row:last-child {
            border-bottom: none;
        }

        .animal-number {
            font-weight: bold;
            color: #007bff;
            font-size: 1.1rem;
        }

        .animal-name {
            color: #333;
            font-weight: 500;
        }

        .animal-count {
            color: #666;
            font-size: 0.9rem;
        }

        .animal-success {
            color: #28a745;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .ai-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .ai-component {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .ai-component h4 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .ai-metrics {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .ai-metrics span {
            font-size: 0.9rem;
            color: #666;
        }

        .error {
            text-align: center;
            color: #dc3545;
            padding: 40px;
        }

        .error i {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        /* Estilos para el modal de todos los animales */
        .all-animals-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .all-animal-card {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .all-animal-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
            border-color: #007bff;
        }

        .all-animal-card.red {
            border-color: #dc3545;
            background: linear-gradient(135deg, #fff5f5, #f8f9fa);
        }

        .all-animal-card.black {
            border-color: #343a40;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
        }

        .all-animal-card.green {
            border-color: #28a745;
            background: linear-gradient(135deg, #f0fff4, #f8f9fa);
        }

        .all-animal-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .all-animal-name {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 3px;
        }

        .all-animal-color {
            font-size: 0.7rem;
            font-weight: bold;
            text-transform: uppercase;
            padding: 2px 6px;
            border-radius: 10px;
            display: inline-block;
        }

        .all-animal-color.red {
            background: #dc3545;
            color: white;
        }

        .all-animal-color.black {
            background: #343a40;
            color: white;
        }

        .all-animal-color.green {
            background: #28a745;
            color: white;
        }

        .all-animals-search {
            margin-bottom: 20px;
        }

        .all-animals-search input {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid #e9ecef;
            border-radius: 25px;
            font-size: 1rem;
            outline: none;
            transition: border-color 0.3s ease;
        }

        .all-animals-search input:focus {
            border-color: #007bff;
        }

        .all-animals-filters {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 6px 12px;
            border: 1px solid #dee2e6;
            background: white;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .filter-btn.active {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }

        .filter-btn:hover {
            background: #e9ecef;
        }

        .filter-btn.active:hover {
            background: #0056b3;
        }

        .effectiveness-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }

        .effectiveness-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 12px;
            text-align: center;
            border-left: 3px solid;
        }

        .effectiveness-card.animals {
            border-left-color: #28a745;
        }

        .effectiveness-card.colors {
            border-left-color: #007bff;
        }

        .effectiveness-card.overall {
            border-left-color: #ffc107;
        }

        .effectiveness-card h3 {
            font-size: 0.9rem;
            margin-bottom: 5px;
            color: #333;
        }

        .effectiveness-card .percentage {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 3px;
        }

        .effectiveness-card.animals .percentage {
            color: #28a745;
        }

        .effectiveness-card.colors .percentage {
            color: #007bff;
        }

        .effectiveness-card.overall .percentage {
            color: #ffc107;
        }

        .effectiveness-card .details {
            font-size: 0.7rem;
            color: #666;
        }

        .results-history {
            max-height: 200px;
            overflow-y: auto;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 10px;
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            margin-bottom: 5px;
            background: white;
            border-radius: 6px;
            font-size: 0.8rem;
        }

        .history-item:last-child {
            margin-bottom: 0;
        }

        .history-animal {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .history-result {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .hit {
            color: #28a745;
        }

        .miss {
            color: #dc3545;
        }

        @media (max-width: 480px) {
            .container {
                padding: 8px;
            }

            .header h1 {
                font-size: 1.5rem;
            }

            .stats-row {
                grid-template-columns: repeat(2, 1fr);
                gap: 6px;
            }

            .stat-card {
                padding: 8px 6px;
            }

            .stat-card h3 {
                font-size: 1rem;
            }

            .controls {
                gap: 6px;
            }

            .btn {
                padding: 6px 12px;
                font-size: 0.75rem;
                min-width: 80px;
            }

                         .results-grid {
                 grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
                 gap: 6px;
             }

                         .result-card {
                 padding: 6px 4px;
                 min-height: 60px;
             }
        }

        /* Estilos para el modal de historial de animales */
        .animal-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border-left: 4px solid #007bff;
        }

        .stat-card h4 {
            margin: 0 0 10px 0;
            color: #495057;
            font-size: 0.9rem;
        }

        .stat-card .value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #007bff;
        }

        .recent-appearances {
            margin-bottom: 20px;
        }

        .recent-appearances h3 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .appearance-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin-bottom: 8px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #28a745;
        }

        .appearance-time {
            font-weight: bold;
            color: #495057;
        }

        .appearance-gap {
            color: #6c757d;
            font-size: 0.9rem;
        }

        .hour-pattern {
            margin-bottom: 20px;
        }

        .hour-pattern h3 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .hour-chart {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 5px;
            margin-bottom: 15px;
        }

        .hour-bar {
            background: #e9ecef;
            border-radius: 5px;
            padding: 8px 5px;
            text-align: center;
            font-size: 0.8rem;
            position: relative;
        }

        .hour-bar.active {
            background: #007bff;
            color: white;
        }

        .hour-bar .count {
            font-weight: bold;
        }

        .hour-bar .hour {
            font-size: 0.7rem;
            opacity: 0.8;
        }

        .clickable-card {
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .modal-animal-card.clickable-card {
            cursor: pointer;
        }

        .clickable-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .result-number {
            font-size: 1.1rem;
        }

        .result-animal {
            font-size: 0.8rem;
        }

        .result-time {
            font-size: 0.7rem;
        }

        .temperature-stats {
            grid-template-columns: 1fr;
            gap: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ Animalitos Predictor</h1>
            <p>Sistema Inteligente de Predicciones</p>
        </div>
        
        <!-- Secci√≥n de debug eliminada -->

        <div class="stats-row">
            <div class="stat-card">
                <i class="fas fa-database"></i>
                <h3 id="totalResults">0</h3>
                <p>Total</p>
            </div>
            <div class="stat-card">
                <i class="fas fa-clock"></i>
                <h3 id="lastUpdate">N/A</h3>
                <p>√öltima</p>
            </div>
            <div class="stat-card">
                <i class="fas fa-chart-bar"></i>
                <h3 id="uniqueAnimals">0</h3>
                <p>√önicos</p>
            </div>
            <div class="stat-card">
                <i class="fas fa-sync-alt"></i>
                <h3 id="updateStatus">Inactivo</h3>
                <p>Estado</p>
            </div>
        </div>



        <div class="controls">
            <button class="btn btn-primary" onclick="forceUpdate()">
                <i class="fas fa-sync"></i>
                Actualizar
            </button>
            <button class="btn btn-success" onclick="startAutoUpdate()">
                <i class="fas fa-play"></i>
                Auto
            </button>
            <button class="btn btn-danger" onclick="showStatsModal()">
                <i class="fas fa-chart-line"></i>
                Estad√≠sticas
            </button>

                            <a href="/effectiveness-history.html" class="btn" style="background: linear-gradient(45deg, #ff6b6b, #ee5a52); color: white;">
                    <i class="fas fa-history"></i>
                    Historial Completo
                </a>
                        
        </div>

        <div class="section">
            <h2 class="section-title">
                <i class="fas fa-list"></i>
                √öltimos Resultados
            </h2>
            <div id="resultsContainer">
                <div class="loading">
                    <i class="fas fa-spinner"></i>
                    <p>Cargando...</p>
                </div>
            </div>
        </div>

        <div class="section">
            <h2 class="section-title">
                <i class="fas fa-crystal-ball"></i>
                Predicciones Inteligentes
                <button class="btn btn-info" onclick="showAllAnimalsModal()" style="margin-left: 15px; padding: 8px 16px; font-size: 0.8rem;">
                    <i class="fas fa-list"></i>
                    Ver Todos los Animales
                </button>
            </h2>
            <div id="predictionsContainer">
                <div class="loading">
                    <i class="fas fa-spinner"></i>
                    <p>Generando predicciones...</p>
                </div>
            </div>
            <div class="alternative-buttons">
                <button class="btn btn-black" onclick="showColorModal('black')">
                    <i class="fas fa-circle" style="color: #343a40; background: white; border-radius: 50%; width: 12px; height: 12px; display: inline-block; margin-right: 5px;"></i>
                    Ver Negros
                </button>
                <button class="btn btn-red" onclick="showColorModal('red')">
                    <i class="fas fa-circle" style="color: #dc3545; background: white; border-radius: 50%; width: 12px; height: 12px; display: inline-block; margin-right: 5px;"></i>
                    Ver Rojos
                </button>
            </div>
        </div>

        <div class="section">
            <h2 class="section-title">
                <i class="fas fa-chart-line"></i>
                Efectividad de Predicciones
            </h2>
            <div id="effectivenessContainer">
                <div class="loading">
                    <i class="fas fa-spinner"></i>
                    <p>Cargando estad√≠sticas...</p>
                </div>
            </div>
        </div>

        <!-- Modal para historial de animales -->
        <div id="animalModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="modalTitle">Historial del Animal</h2>
                    <span class="close" onclick="closeAnimalModal(); closeTemperatureModal();">&times;</span>
                </div>
                <div class="modal-body">
                    <div id="modalContent">
                        <div class="loading">
                            <i class="fas fa-spinner"></i>
                            <p>Cargando historial...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal para estad√≠sticas de efectividad -->
        <div id="statsModal" class="modal">
            <div class="modal-content" style="max-width: 900px;">
                <div class="modal-header">
                    <h2><i class="fas fa-chart-line"></i> Estad√≠sticas de Efectividad de por Vida</h2>
                    <span class="close" onclick="closeStatsModal()">&times;</span>
                </div>
                <div class="modal-body">
                    <div id="statsContent">
                        <div class="loading">
                            <i class="fas fa-spinner"></i>
                            <p>Cargando estad√≠sticas...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal para todos los animales -->
        <div id="allAnimalsModal" class="modal">
            <div class="modal-content" style="max-width: 1000px;">
                <div class="modal-header">
                    <h2><i class="fas fa-list"></i> Todos los Animales</h2>
                    <span class="close" onclick="closeAllAnimalsModal()">&times;</span>
                </div>
                <div class="modal-body">
                    <div id="allAnimalsContent">
                        <div class="loading">
                            <i class="fas fa-spinner"></i>
                            <p>Cargando todos los animales...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    <!-- Modal de Colores -->
    <div id="colorModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="colorModalTitle">üé® Animales por Color</h2>
                <span class="close" onclick="closeColorModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div id="colorModalContent">
                    <!-- Contenido din√°mico aqu√≠ -->
                </div>
            </div>
        </div>
    </div>

    </div>

    <script>
        let autoUpdateInterval = null;
        let updateCounter = 0;
        let lastUpdateTime = null;

        // Cargar datos iniciales
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('üöÄ Iniciando aplicaci√≥n...');
            
            try {
                // Cargar datos iniciales en paralelo
                await Promise.all([
                    loadStats(),
                    loadResults(),
                    loadPredictions(),
                    loadEffectiveness()
                ]);
                
                console.log('‚úÖ Datos iniciales cargados exitosamente');
                
                // Iniciar auto-update autom√°ticamente
                await startAutoUpdate();
                
                console.log('‚úÖ Aplicaci√≥n iniciada completamente');
            } catch (error) {
                console.error('‚ùå Error iniciando aplicaci√≥n:', error);
                showError('Error iniciando aplicaci√≥n');
            }
        });

        async function loadStats() {
            try {
                const response = await fetch('/api/stats');
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('totalResults').textContent = data.stats.totalResultados;
                    document.getElementById('uniqueAnimals').textContent = data.stats.animalesUnicos;
                    
                    if (data.stats.ultimaActualizacion) {
                        const date = new Date(data.stats.ultimaActualizacion);
                        document.getElementById('lastUpdate').textContent = date.toLocaleTimeString('es-ES', {hour: '2-digit', minute: '2-digit'});
                    }
                }
            } catch (error) {
                console.error('Error cargando estad√≠sticas:', error);
            }
        }

        // Variable para evitar llamadas simult√°neas
        let isLoadingResults = false;
        let lastResultsData = null;
        
        async function loadResults() {
            // Evitar llamadas simult√°neas
            if (isLoadingResults) {
                console.log('‚ö†Ô∏è loadResults ya en ejecuci√≥n, saltando...');
                return;
            }
            
            isLoadingResults = true;
            try {
                const startTime = Date.now();
                // Agregar timestamp para evitar cache
                const timestamp = new Date().getTime();
                const response = await fetch(`/api/last-results?t=${timestamp}&v=${Math.random()}`, {
                    headers: {
                        'Cache-Control': 'no-cache, no-store, must-revalidate',
                        'Pragma': 'no-cache',
                        'Expires': '0'
                    }
                });
                const data = await response.json();
                
                if (data.success) {
                    const loadTime = Date.now() - startTime;
                    console.log(`üìä Resultados cargados: ${data.results.length} elementos (${loadTime}ms)`);
                    
                    if (data.results.length > 0) {
                        const latestResult = data.results[0];
                        console.log(`üïê √öltimo resultado: ${latestResult.timeStr} - ${latestResult.animal} (${latestResult.number})`);
                        
                        // SIEMPRE actualizar el display para asegurar datos frescos
                        displayResults(data.results);
                    }
                } else {
                    console.error('‚ùå Error en respuesta de resultados:', data.error);
                    showError('Error cargando resultados');
                }
            } catch (error) {
                console.error('‚ùå Error cargando resultados:', error);
                showError('Error de conexi√≥n');
            } finally {
                isLoadingResults = false;
            }
        }

        function displayResults(results) {
            const container = document.getElementById('resultsContainer');
            
            if (results.length === 0) {
                container.innerHTML = '<div class="loading"><p>No hay resultados</p></div>';
                return;
            }

            const resultsHTML = results.map(result => `
                <div class="result-card color-${result.color} bg-${result.color} clickable-card" onclick="showAnimalModal(${result.number}, '${result.animal}', '${result.color}', null)">
                    <div class="result-number">${result.number.toString().padStart(2, '0')}</div>
                    <div class="result-animal">${result.animal}</div>
                    <div class="result-time">${result.timeStr}</div>
                </div>
            `).join('');

            container.innerHTML = `
                <div class="results-grid">
                    ${resultsHTML}
                </div>
            `;
        }

        async function forceUpdate() {
            try {
                console.log('üîÑ Forzando actualizaci√≥n manual...');
                showMessage('Actualizando manualmente...', 'info');
                
                // Cambiar el bot√≥n para mostrar que est√° ejecut√°ndose
                const updateButton = document.querySelector('button[onclick="forceUpdate()"]');
                const originalButtonText = updateButton.innerHTML;
                updateButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Actualizando...';
                updateButton.disabled = true;
                
                // Mostrar indicador visual
                const statusElement = document.getElementById('updateStatus');
                if (statusElement) {
                    statusElement.textContent = 'Actualizando Manual...';
                    statusElement.style.color = '#ffc107';
                }
                
                // Intentar forzar actualizaci√≥n en el backend
                try {
                    const response = await fetch('/api/force-update', { method: 'POST' });
                    const data = await response.json();
                    
                    if (data.success) {
                        console.log('‚úÖ Backend actualizado correctamente');
                    } else {
                        console.log('‚ö†Ô∏è Backend no pudo actualizar, pero continuando...');
                    }
                } catch (backendError) {
                    console.log('‚ö†Ô∏è Error en backend, pero continuando con actualizaci√≥n del frontend...');
                }
                
                // Siempre actualizar el frontend
                console.log('üîÑ Actualizando datos del frontend...');
                await loadStats();
                await loadResults();
                await loadPredictions();
                await loadEffectiveness();
                
                // Mostrar √©xito
                showMessage('‚úÖ Actualizaci√≥n manual completada', 'success');
                console.log('‚úÖ Actualizaci√≥n manual completada');
                
                // Restaurar estado despu√©s de 2 segundos
                setTimeout(() => {
                    if (statusElement) {
                        statusElement.textContent = 'Siempre Activo';
                        statusElement.style.color = '#28a745';
                    }
                    
                    // Restaurar el bot√≥n
                    if (updateButton) {
                        updateButton.innerHTML = originalButtonText;
                        updateButton.disabled = false;
                    }
                }, 2000);
                
            } catch (error) {
                console.error('‚ùå Error en actualizaci√≥n manual:', error);
                showError('Error en actualizaci√≥n manual');
                
                // Restaurar estado en caso de error
                const statusElement = document.getElementById('updateStatus');
                if (statusElement) {
                    statusElement.textContent = 'Error';
                    statusElement.style.color = '#dc3545';
                    
                    setTimeout(() => {
                        statusElement.textContent = 'Siempre Activo';
                        statusElement.style.color = '#28a745';
                    }, 3000);
                }
                
                // Restaurar el bot√≥n en caso de error
                const updateButton = document.querySelector('button[onclick="forceUpdate()"]');
                if (updateButton) {
                    updateButton.innerHTML = '<i class="fas fa-sync"></i> Actualizar';
                    updateButton.disabled = false;
                }
            }
        }

        async function startAutoUpdate() {
            try {
                const response = await fetch('/api/start-auto-update', { method: 'POST' });
                const data = await response.json();
                
                if (data.success) {
                    showMessage('Sistema siempre activo', 'success');
                    document.getElementById('updateStatus').textContent = 'Siempre Activo';
                    
                    if (autoUpdateInterval) {
                        clearInterval(autoUpdateInterval);
                    }
                    
                    autoUpdateInterval = setInterval(async () => {
                        const updateTime = new Date().toLocaleTimeString();
                        updateCounter++;
                        lastUpdateTime = updateTime;
                        
                        console.log(`üîÑ Auto-update #${updateCounter} ejecut√°ndose...`, updateTime);
                        
                        // Mostrar indicador visual de actualizaci√≥n
                        const statusElement = document.getElementById('updateStatus');
                        if (statusElement) {
                            statusElement.textContent = `Actualizando #${updateCounter}`;
                            statusElement.classList.add('updating');
                        }
                        
                        try {
                            // Ejecutar todas las actualizaciones en paralelo para mayor velocidad
                            await Promise.all([
                                loadStats(),
                                loadResults(),
                                loadPredictions(),
                                loadEffectiveness()
                            ]);
                            
                            console.log(`‚úÖ Auto-update #${updateCounter} completado exitosamente`, updateTime);
                        } catch (error) {
                            console.error(`‚ùå Error en auto-update #${updateCounter}:`, error);
                        }
                        
                        // Restaurar estado despu√©s de 1 segundo
                        setTimeout(() => {
                            if (statusElement) {
                                statusElement.textContent = 'Siempre Activo';
                                statusElement.classList.remove('updating');
                                statusElement.style.color = '#28a745';
                            }
                        }, 1000);
                    }, 2000); // Actualizar cada 2 segundos para mayor precisi√≥n
                    
                    console.log('‚úÖ Sistema configurado para actualizaci√≥n autom√°tica continua');
                } else {
                    showError('Error iniciando auto-update');
                }
            } catch (error) {
                console.error('Error iniciando auto-update:', error);
                showError('Error de conexi√≥n');
            }
        }



        function showMessage(message, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = type === 'success' ? 'success' : 'error';
            messageDiv.textContent = message;
            
            const container = document.querySelector('.container');
            container.insertBefore(messageDiv, container.firstChild);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 3000);
        }

        function showError(message) {
            showMessage(message, 'error');
        }
        


        async function loadPredictions() {
            try {
                console.log('üîÑ Cargando predicciones desde el frontend...');
                const response = await fetch('/api/predictions');
                const data = await response.json();
                
                if (data.success) {
                    console.log('‚úÖ Predicciones cargadas:', data.predictions.length, 'animales');
                    console.log('üìä Animales predichos:', data.predictions.map(p => `${p.animal} (${p.totalProbability.toFixed(1)}%)`).join(', '));
                    displayPredictions(data.predictions, data.analysis, data.colorPrediction, data.effectiveness);
                } else {
                    console.error('‚ùå Error en respuesta de predicciones:', data.error);
                    showError('Error cargando predicciones');
                }
            } catch (error) {
                console.error('‚ùå Error cargando predicciones:', error);
                showError('Error de conexi√≥n');
            }
        }



        async function loadEffectiveness() {
            try {
                const response = await fetch('/api/effectiveness');
                const data = await response.json();
                
                if (data.success) {
                    displayEffectiveness(data.effectiveness);
                } else {
                    showError('Error cargando efectividad');
                }
            } catch (error) {
                console.error('Error cargando efectividad:', error);
                showError('Error de conexi√≥n');
            }
        }



        function displayEffectiveness(effectiveness) {
            const container = document.getElementById('effectivenessContainer');
            
            if (effectiveness.totalPredictions === 0) {
                container.innerHTML = '<div class="loading"><p>No hay datos de efectividad disponibles</p></div>';
                return;
            }

            const effectivenessHTML = `
                <div class="effectiveness-grid">
                    <div class="effectiveness-card animals">
                        <h3>üéØ Animales</h3>
                        <div class="percentage">${effectiveness.animalAccuracy}%</div>
                        <div class="details">${effectiveness.correctAnimals}/${effectiveness.totalComparisons} aciertos</div>
                    </div>
                    <div class="effectiveness-card colors">
                        <h3>üé® Colores</h3>
                        <div class="percentage">${effectiveness.colorAccuracy}%</div>
                        <div class="details">${effectiveness.correctColors}/${effectiveness.totalComparisons} aciertos</div>
                    </div>
                    <div class="effectiveness-card overall">
                        <h3>üìä General</h3>
                        <div class="percentage">${effectiveness.overallAccuracy}%</div>
                        <div class="details">${effectiveness.totalPredictions} predicciones</div>
                    </div>
                </div>
                
                <div class="results-history">
                    <h3 style="margin-bottom: 10px; font-size: 0.9rem;">üìà √öltimos 10 Resultados</h3>
                    ${effectiveness.last10Results.map(result => `
                        <div class="history-item">
                            <div class="history-animal">
                                <span>${result.animal.toString().padStart(2, '0')} ${result.animalName}</span>
                                <span style="color: ${result.color === 'red' ? '#dc3545' : result.color === 'black' ? '#343a40' : '#28a745'}">‚óè</span>
                                <span style="font-size: 0.8rem; color: #666; margin-left: 8px;">${result.timeStr || ''}</span>
                            </div>
                            <div class="history-result">
                                <span class="${result.animalHit ? 'hit' : 'miss'}">${result.animalHit ? '‚úÖ' : '‚ùå'}</span>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;

            container.innerHTML = effectivenessHTML;
        }



        // Variable global para almacenar los datos adicionales de los animales
        let animalData = {};

        function displayPredictions(predictions, analysis, colorPrediction, effectiveness) {
            const container = document.getElementById('predictionsContainer');
            
            if (predictions.length === 0) {
                container.innerHTML = '<div class="loading"><p>No hay predicciones</p></div>';
                return;
            }

            const predictionsHTML = predictions.map((pred, index) => {
                const tempEmoji = pred.temperature === 'hot' ? 'üî•' : pred.temperature === 'warm' ? 'üå§Ô∏è' : pred.temperature === 'cold' ? '‚ùÑÔ∏è' : '';
                const tempClass = pred.temperature ? `temperature-${pred.temperature}` : '';
                
                return `
                    <div class="result-card color-${pred.color} bg-${pred.color} clickable-card" onclick="showAnimalModal(${pred.animal}, '${pred.animalName}', '${pred.color}', ${pred.totalProbability})">
                        ${tempEmoji ? `<div class="temperature-indicator ${tempClass}">${tempEmoji}</div>` : ''}
                        <div class="result-number">${pred.animal.toString().padStart(2, '0')}</div>
                        <div class="result-animal">${pred.animalName}</div>
                        <div class="result-time" style="color: #28a745; font-weight: bold;">
                            ${pred.totalProbability.toFixed(1)}%
                        </div>
                    </div>
                `;
            }).join('');

            const colorEmoji = colorPrediction.color === 'red' ? 'üî¥' : colorPrediction.color === 'black' ? '‚ö´' : 'üü¢';
            const colorName = colorPrediction.color === 'red' ? 'ROJO' : colorPrediction.color === 'black' ? 'NEGRO' : 'VERDE';

            container.innerHTML = `
                <div class="analysis-grid">
                    <div class="analysis-card" style="border-left-color: #007bff;">
                        <h3>üìä An√°lisis General</h3>
                        <p>Total: <strong>${analysis.totalResults}</strong></p>
                        <p>Colores: üî¥${analysis.colorStats?.redPercent}% ‚ö´${analysis.colorStats?.blackPercent}% üü¢${analysis.colorStats?.greenPercent}%</p>
                        <p>Pesos: Patrones ${analysis.patternWeight}% | Temp ${analysis.temperatureWeight}%</p>
                    </div>
                    
                    <div class="color-prediction">
                        <span>${colorEmoji}</span>
                        <div>
                            <p>${colorName}</p>
                            <p>${colorPrediction.probability}% - ${colorPrediction.reason}</p>
                        </div>
                    </div>
                    
                    <div class="analysis-card" style="border-left-color: #ffc107;">
                        <h3>üå°Ô∏è Clasificaci√≥n por Temperatura</h3>
                        <div class="temperature-stats">
                            <div class="temp-stat hot" onclick="showTemperatureModal('hot')" style="cursor: pointer;">
                                <strong>üî• ${analysis.temperatureStats?.hot || 0}</strong><br>
                                Calientes
                            </div>
                            <div class="temp-stat warm" onclick="showTemperatureModal('warm')" style="cursor: pointer;">
                                <strong>üå§Ô∏è ${analysis.temperatureStats?.warm || 0}</strong><br>
                                Tibios
                            </div>
                            <div class="temp-stat cold" onclick="showTemperatureModal('cold')" style="cursor: pointer;">
                                <strong>‚ùÑÔ∏è ${analysis.temperatureStats?.cold || 0}</strong><br>
                                Fr√≠os
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="results-grid">
                    ${predictionsHTML}
                </div>
            `;
        }



        // Modificar la funci√≥n displayPredictions para incluir los datos de animales
        const originalDisplayPredictionsWithAnimalData = displayPredictions;
        displayPredictions = function(predictions, analysis, colorPrediction, effectiveness) {
            // Actualizar los datos de animales si est√°n disponibles
            if (effectiveness && effectiveness.animalData) {
                animalData = effectiveness.animalData;
            }
            originalDisplayPredictionsWithAnimalData(predictions, analysis, colorPrediction, effectiveness);
        };

        // Variables globales para el modal
        let temperatureData = {
            hot: [],
            warm: [],
            cold: []
        };
        
        // Bandera para prevenir actualizaciones cuando hay un modal abierto
        let isModalOpen = false;

        // Funci√≥n SIMPLE para mostrar el modal de temperatura (usando animalModal)
        function showTemperatureModal(temperature) {
            isModalOpen = true; // Establecer bandera para prevenir actualizaciones
            console.log('üå°Ô∏è Mostrando modal de temperatura:', temperature);
            console.log('üìä Datos de temperatura disponibles:', temperatureData);
            console.log('üìä Estructura de temperatureData:', JSON.stringify(temperatureData, null, 2));
            
            const modal = document.getElementById('animalModal');
            const modalTitle = document.querySelector('#animalModal h2');
            const modalContent = document.querySelector('#animalModal #modalContent');
            
            console.log('üîç Elementos del modal encontrados:', { 
                modal: modal ? 'ENCONTRADO' : 'NO ENCONTRADO', 
                modalTitle: modalTitle ? 'ENCONTRADO' : 'NO ENCONTRADO', 
                modalContent: modalContent ? 'ENCONTRADO' : 'NO ENCONTRADO' 
            });
            
            let title, animals, emoji;
            
            switch(temperature) {
                case 'hot':
                    title = 'üî• Animales Calientes';
                    emoji = 'üî•';
                    animals = temperatureData.hot;
                    console.log('üî• Animales calientes seleccionados:', animals);
                    console.log('üî• Cantidad de animales calientes:', animals ? animals.length : 'UNDEFINED');
                    break;
                case 'warm':
                    title = 'üå§Ô∏è Animales Tibios';
                    emoji = 'üå§Ô∏è';
                    animals = temperatureData.warm;
                    console.log('üå§Ô∏è Animales tibios seleccionados:', animals);
                    console.log('üå§Ô∏è Cantidad de animales tibios:', animals ? animals.length : 'UNDEFINED');
                    break;
                case 'cold':
                    title = '‚ùÑÔ∏è Animales Fr√≠os';
                    emoji = '‚ùÑÔ∏è';
                    animals = temperatureData.cold;
                    console.log('‚ùÑÔ∏è Animales fr√≠os seleccionados:', animals);
                    console.log('‚ùÑÔ∏è Cantidad de animales fr√≠os:', animals ? animals.length : 'UNDEFINED');
                    break;
                default:
                    console.log('‚ö†Ô∏è Temperatura no reconocida:', temperature);
                    return;
            }
            
            console.log('üìù T√≠tulo a mostrar:', title);
            console.log('üêæ Animales a mostrar:', animals);
            console.log('üêæ Tipo de animals:', typeof animals);
            console.log('üêæ Es array:', Array.isArray(animals));
            
            if (!modalTitle || !modalContent) {
                console.error('‚ùå Elementos del modal no encontrados');
                return;
            }
            
            modalTitle.innerHTML = title;
            
            if (animals && Array.isArray(animals) && animals.length > 0) {
                console.log('‚úÖ Generando HTML para', animals.length, 'animales');
                console.log('‚úÖ Primer animal de ejemplo:', animals[0]);
                
                const animalsHTML = animals.map((animal, index) => {
                    console.log(`üé® Procesando animal ${index}:`, animal);
                    return `
                        <div class="modal-animal-card color-${animal.color} clickable-card" onclick="showAnimalModal(${animal.number}, '${animal.name}', '${animal.color}', ${animal.percentage})">
                            <div class="modal-animal-number">${animal.number.toString().padStart(2, '0')}</div>
                            <div class="modal-animal-name">${animal.name}</div>
                            <div class="modal-animal-count">${animal.frequency} veces (${animal.percentage.toFixed(1)}%)</div>
                            <div class="modal-animal-color" style="color: ${animal.color === 'red' ? '#dc3545' : animal.color === 'black' ? '#343a40' : '#28a745'}">‚óè</div>
                        </div>
                    `;
                }).join('');
                
                const finalHTML = `
                    <div class="modal-animals-grid">
                        ${animalsHTML}
                    </div>
                `;
                
                console.log('üé® HTML generado:', finalHTML);
                modalContent.innerHTML = finalHTML;
            } else {
                console.log('‚ö†Ô∏è No hay animales para mostrar');
                console.log('‚ö†Ô∏è animals es:', animals);
                console.log('‚ö†Ô∏è animals.length:', animals ? animals.length : 'N/A');
                modalContent.innerHTML = '<p style="text-align: center; padding: 20px; color: #666;">No hay datos disponibles para esta categor√≠a.</p>';
            }
            
            // Mostrar modal
            modal.style.display = 'block';
            
            console.log('‚úÖ Modal mostrado');
        }

        // FUNCI√ìN DUPLICADA ELIMINADA - AHORA EST√Å AL FINAL DEL SCRIPT

        // Funci√≥n para cerrar el modal
        function closeTemperatureModal() {
            document.getElementById('animalModal').style.display = 'none';
            isModalOpen = false; // Resetear bandera para permitir actualizaciones
        }

        // Cerrar modal al hacer clic fuera de √©l
        window.onclick = function(event) {
            const colorModal = document.getElementById('colorModal');
            const animalModal = document.getElementById('animalModal');
            const statsModal = document.getElementById('statsModal');
            const allAnimalsModal = document.getElementById('allAnimalsModal');
            
            if (event.target === animalModal && isModalOpen) {
                animalModal.style.display = 'none';
                isModalOpen = false; // Resetear bandera
            }
            if (event.target === colorModal) {
                colorModal.style.display = 'none';
            }
            if (event.target === animalModal) {
                animalModal.style.display = 'none';
            }
            if (event.target === statsModal) {
                statsModal.style.display = 'none';
            }
            if (event.target === allAnimalsModal) {
                allAnimalsModal.style.display = 'none';
            }
        }

        // Funci√≥n para actualizar los datos de temperatura
        function updateTemperatureData(analysis) {
            // NO actualizar si hay un modal abierto para evitar sobrescribir el contenido
            if (isModalOpen) {
                console.log('üîí Modal abierto - saltando actualizaci√≥n de temperatura');
                return;
            }
            
            console.log('üå°Ô∏è Actualizando datos de temperatura:', analysis);
            console.log('üå°Ô∏è analysis.temperatureStats:', analysis ? analysis.temperatureStats : 'ANALYSIS ES NULL');
            
            if (analysis && analysis.temperatureStats) {
                console.log('üìä Datos de temperatura encontrados:', analysis.temperatureStats);
                console.log('üìä hotAnimals:', analysis.temperatureStats.hotAnimals);
                console.log('üìä warmAnimals:', analysis.temperatureStats.warmAnimals);
                console.log('üìä coldAnimals:', analysis.temperatureStats.coldAnimals);
                
                temperatureData = {
                    hot: analysis.temperatureStats.hotAnimals || [],
                    warm: analysis.temperatureStats.warmAnimals || [],
                    cold: analysis.temperatureStats.coldAnimals || []
                };
                
                console.log('üî• Animales calientes:', temperatureData.hot.length, temperatureData.hot);
                console.log('üå§Ô∏è Animales tibios:', temperatureData.warm.length, temperatureData.warm);
                console.log('‚ùÑÔ∏è Animales fr√≠os:', temperatureData.cold.length, temperatureData.cold);
                
                // Verificar estructura de los datos
                if (temperatureData.hot.length > 0) {
                    console.log('üî• Ejemplo de animal caliente:', temperatureData.hot[0]);
                }
                if (temperatureData.warm.length > 0) {
                    console.log('üå§Ô∏è Ejemplo de animal tibio:', temperatureData.warm[0]);
                }
                if (temperatureData.cold.length > 0) {
                    console.log('‚ùÑÔ∏è Ejemplo de animal fr√≠o:', temperatureData.cold[0]);
                }
            } else {
                console.log('‚ö†Ô∏è No se encontraron datos de temperatura en analysis');
                console.log('‚ö†Ô∏è analysis es:', analysis);
                console.log('‚ö†Ô∏è analysis.temperatureStats es:', analysis ? analysis.temperatureStats : 'N/A');
            }
        }

        // Modificar la funci√≥n displayPredictions para incluir los datos de temperatura
        const originalDisplayPredictions = displayPredictions;
        displayPredictions = function(predictions, analysis, colorPrediction, effectiveness) {
            // updateTemperatureData(analysis); // REMOVIDO - se llama en la funci√≥n consolidada
            originalDisplayPredictions(predictions, analysis, colorPrediction, effectiveness);
        };

        // Variables globales para los modales de color
        let colorAnimalsData = {
            red: [],
            black: []
        };

        // Funci√≥n para mostrar el modal de color
        function showColorModal(color) {
            const modal = document.getElementById('colorModal');
            const modalTitle = document.getElementById('colorModalTitle');
            const modalContent = document.getElementById('colorModalContent');
            
            console.log('üé® Mostrando modal de color:', color);
            console.log('üé® Datos de color disponibles:', colorAnimalsData);
            
            if (!modal || !modalTitle || !modalContent) {
                console.error('‚ùå Elementos del modal de color no encontrados');
                return;
            }
            
            let title, animals, colorName, colorEmoji;
            
            switch(color) {
                case 'red':
                    title = 'üî¥ Top 5 Animales Rojos';
                    colorName = 'Rojos';
                    colorEmoji = 'üî¥';
                    animals = colorAnimalsData.red || [];
                    break;
                case 'black':
                    title = '‚ö´ Top 5 Animales Negros';
                    colorName = 'Negros';
                    colorEmoji = '‚ö´';
                    animals = colorAnimalsData.black || [];
                    break;
                default:
                    console.error('‚ùå Color no v√°lido:', color);
                    return;
            }
            
            modalTitle.innerHTML = title;
            
            // Si no hay datos, generar datos por defecto
            if (!animals || animals.length === 0) {
                console.log('‚ö†Ô∏è No hay datos de color, generando datos por defecto...');
                updateColorAnimalsData([]); // Generar con datos vac√≠os
                animals = color === 'red' ? colorAnimalsData.red : colorAnimalsData.black;
            }
            
            if (animals && animals.length > 0) {
                const animalsHTML = animals.map(animal => `
                    <div class="modal-animal-card color-${animal.color} clickable-card" onclick="showAnimalModal(${animal.animal}, '${animal.animalName}', '${animal.color}', ${animal.totalProbability || 0})">
                        <div class="modal-animal-number">${animal.animal.toString().padStart(2, '0')}</div>
                        <div class="modal-animal-name">${animal.animalName}</div>
                        <div class="modal-animal-score">${animal.totalProbability ? animal.totalProbability.toFixed(1) + '%' : 'N/A'}</div>
                        <div class="modal-animal-color" style="color: ${animal.color === 'red' ? '#dc3545' : '#343a40'}">‚óè</div>
                    </div>
                `).join('');
                
                modalContent.innerHTML = `
                    <div class="modal-animals-grid">
                        ${animalsHTML}
                    </div>
                `;
            } else {
                modalContent.innerHTML = '<p style="text-align: center; padding: 20px; color: #666;">No hay datos disponibles para esta categor√≠a.</p>';
            }
            
            modal.style.display = 'block';
        }

        // Funci√≥n para cerrar el modal de color
        function closeColorModal() {
            document.getElementById('colorModal').style.display = 'none';
        }



        // Mapeo completo de todos los animales (variable global)
        const allAnimals = {
            0: { animal: 0, animalName: "Delf√≠n", color: "green" },
            1: { animal: 1, animalName: "Carnero", color: "red" },
            2: { animal: 2, animalName: "Toro", color: "black" },
            3: { animal: 3, animalName: "Ciempies", color: "red" },
            4: { animal: 4, animalName: "Alacran", color: "black" },
            5: { animal: 5, animalName: "Le√≥n", color: "red" },
            6: { animal: 6, animalName: "Rana", color: "black" },
            7: { animal: 7, animalName: "Perico", color: "red" },
            8: { animal: 8, animalName: "Rat√≥n", color: "black" },
            9: { animal: 9, animalName: "Aguila", color: "red" },
            10: { animal: 10, animalName: "Tigre", color: "black" },
            11: { animal: 11, animalName: "Gato", color: "black" },
            12: { animal: 12, animalName: "Caballo", color: "red" },
            13: { animal: 13, animalName: "Mono", color: "black" },
            14: { animal: 14, animalName: "Paloma", color: "red" },
            15: { animal: 15, animalName: "Zorro", color: "black" },
            16: { animal: 16, animalName: "Oso", color: "red" },
            17: { animal: 17, animalName: "Pavo", color: "black" },
            18: { animal: 18, animalName: "Burro", color: "red" },
            19: { animal: 19, animalName: "Chivo", color: "red" },
            20: { animal: 20, animalName: "Cochino", color: "black" },
            21: { animal: 21, animalName: "Gallo", color: "red" },
            22: { animal: 22, animalName: "Camello", color: "black" },
            23: { animal: 23, animalName: "Cebra", color: "red" },
            24: { animal: 24, animalName: "Iguana", color: "black" },
            25: { animal: 25, animalName: "Gallina", color: "red" },
            26: { animal: 26, animalName: "Vaca", color: "black" },
            27: { animal: 27, animalName: "Perro", color: "red" },
            28: { animal: 28, animalName: "Zamuro", color: "black" },
            29: { animal: 29, animalName: "Elefante", color: "black" },
            30: { animal: 30, animalName: "Caiman", color: "red" },
            31: { animal: 31, animalName: "Lapa", color: "black" },
            32: { animal: 32, animalName: "Ardilla", color: "red" },
            33: { animal: 33, animalName: "Pescado", color: "black" },
            34: { animal: 34, animalName: "Venado", color: "red" },
            35: { animal: 35, animalName: "Jirafa", color: "black" },
            36: { animal: 36, animalName: "Culebra", color: "red" },
            37: { animal: 37, animalName: "Ballena", color: "green" }
        };

        // Funci√≥n para actualizar los datos de animales por color
        function updateColorAnimalsData(predictions) {

            // Obtener todos los animales rojos y negros
            const allRedAnimals = Object.values(allAnimals).filter(animal => animal.color === 'red');
            const allBlackAnimals = Object.values(allAnimals).filter(animal => animal.color === 'black');

            // Puntajes base ESTABLES basados en patrones hist√≥ricos observados
            const historicalScores = {
                // Animales rojos con mejores patrones hist√≥ricos
                1: 48.5, 3: 47.2, 7: 45.8, 9: 44.1, 19: 43.6, 21: 42.9, 29: 41.7, 35: 40.3,
                // Animales negros con mejores patrones hist√≥ricos  
                2: 49.9, 4: 48.1, 6: 46.7, 11: 45.3, 17: 44.8, 20: 43.4, 33: 42.6, 36: 41.2
            };

            // Si tenemos predicciones, usar esos puntajes, sino usar puntajes hist√≥ricos FIJOS
            const redAnimals = allRedAnimals.map(animal => {
                const prediction = predictions.find(pred => pred.animal === animal.animal);
                // Usar puntaje hist√≥rico fijo o uno base consistente
                const baseProbability = historicalScores[animal.animal] || (35 + (animal.animal % 15));
                return {
                    ...animal,
                    totalProbability: prediction ? prediction.totalProbability : baseProbability
                };
            }).sort((a, b) => b.totalProbability - a.totalProbability).slice(0, 5); // Top 5 rojos

            const blackAnimals = allBlackAnimals.map(animal => {
                const prediction = predictions.find(pred => pred.animal === animal.animal);
                // Usar puntaje hist√≥rico fijo o uno base consistente
                const baseProbability = historicalScores[animal.animal] || (35 + (animal.animal % 15));
                return {
                    ...animal,
                    totalProbability: prediction ? prediction.totalProbability : baseProbability
                };
            }).sort((a, b) => b.totalProbability - a.totalProbability).slice(0, 5); // Top 5 negros

            colorAnimalsData = {
                red: redAnimals,
                black: blackAnimals
            };
        }

        // Modificar la funci√≥n displayPredictions para incluir los datos de color
        const originalDisplayPredictionsWithColor = displayPredictions;
        displayPredictions = function(predictions, analysis, colorPrediction, effectiveness) {
            updateTemperatureData(analysis);
            updateColorAnimalsData(predictions);
            originalDisplayPredictionsWithColor(predictions, analysis, colorPrediction, effectiveness);
        };

        // Funciones para el modal de historial de animales
        async function showAnimalModal(animalNumber, animalName, animalColor, probability) {
            const modal = document.getElementById('animalModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalContent = document.getElementById('modalContent');
            
            modalTitle.textContent = `${animalNumber.toString().padStart(2, '0')} ${animalName}`;
            modalContent.innerHTML = '<div class="loading"><i class="fas fa-spinner"></i><p>Cargando historial...</p></div>';
            modal.style.display = 'block';
            
            try {
                const response = await fetch(`/api/animal-history/${animalNumber}`);
                const data = await response.json();
                
                if (data.success) {
                    displayAnimalHistory(data.history, animalNumber, animalName, animalColor, probability);
                } else {
                    modalContent.innerHTML = '<div class="error">Error cargando historial</div>';
                }
            } catch (error) {
                console.error('Error:', error);
                modalContent.innerHTML = '<div class="error">Error de conexi√≥n</div>';
            }
        }

        function displayAnimalHistory(history, animalNumber, animalName, animalColor, probability) {
            const modalContent = document.getElementById('modalContent');
            
            // Calcular estad√≠sticas
            const totalAppearances = history.allAppearances.length;
            const last100Appearances = history.last100Appearances;
            const recentAppearances = history.recentAppearances;
            const hourPattern = history.hourPattern;
            
            // Encontrar el color del animal
            const animalInfo = allAnimals[animalNumber];
            const color = animalInfo ? animalInfo.color : animalColor;
            const colorEmoji = color === 'red' ? 'üî¥' : color === 'black' ? '‚ö´' : 'üü¢';
            
            const modalHTML = `
                <div class="animal-stats">
                    <div class="stat-card">
                        <h4>Total Apariciones</h4>
                        <div class="value">${totalAppearances}</div>
                    </div>
                    <div class="stat-card">
                        <h4>√öltimos 100</h4>
                        <div class="value">${last100Appearances}</div>
                    </div>
                    <div class="stat-card">
                        <h4>Color</h4>
                        <div class="value">${colorEmoji} ${color.toUpperCase()}</div>
                    </div>
                    ${probability ? `
                    <div class="stat-card">
                        <h4>Probabilidad Actual</h4>
                        <div class="value">${probability.toFixed(1)}%</div>
                    </div>
                    ` : ''}
                </div>
                
                <div class="recent-appearances">
                    <h3>üìÖ √öltimas 5 Apariciones</h3>
                    ${recentAppearances.length > 0 ? recentAppearances.map(appearance => `
                        <div class="appearance-item">
                            <div class="appearance-time">${appearance.timeStr}</div>
                            <div class="appearance-gap">Hace ${appearance.gapMinutes} min</div>
                        </div>
                    `).join('') : '<p>No hay apariciones recientes</p>'}
                </div>
                
                <div class="hour-pattern">
                    <h3>üïê Patr√≥n de Horas (√∫ltimos 100 resultados)</h3>
                    <div class="hour-chart">
                        ${hourPattern.map((count, hour) => `
                            <div class="hour-bar ${count > 0 ? 'active' : ''}">
                                <div class="count">${count}</div>
                                <div class="hour">${hour.toString().padStart(2, '0')}:00</div>
                            </div>
                        `).join('')}
                    </div>
                    <p style="font-size: 0.9rem; color: #666; text-align: center;">
                        Muestra la distribuci√≥n de apariciones por hora del d√≠a
                    </p>
                </div>
            `;
            
            modalContent.innerHTML = modalHTML;
        }

        function closeAnimalModal() {
            const modal = document.getElementById('animalModal');
            modal.style.display = 'none';
        }

        // Funci√≥n para mostrar el modal de estad√≠sticas
        async function showStatsModal() {
            const modal = document.getElementById('statsModal');
            const statsContent = document.getElementById('statsContent');
            
            // Mostrar loading
            statsContent.innerHTML = `
                <div class="loading">
                    <i class="fas fa-spinner"></i>
                    <p>Cargando estad√≠sticas completas...</p>
                </div>
            `;
            
            modal.style.display = 'block';
            
            try {
                // Cargar estad√≠sticas completas
                const response = await fetch('/api/effectiveness-stats');
                const data = await response.json();
                
                if (data.success) {
                    displayFullStats(data.stats);
                } else {
                    statsContent.innerHTML = `
                        <div class="error">
                            <i class="fas fa-exclamation-triangle"></i>
                            <p>Error al cargar las estad√≠sticas</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error cargando estad√≠sticas:', error);
                statsContent.innerHTML = `
                    <div class="error">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>Error de conexi√≥n</p>
                    </div>
                `;
            }
        }
        
        // Funci√≥n para mostrar las estad√≠sticas completas
        function displayFullStats(stats) {
            const statsContent = document.getElementById('statsContent');
            
            const statsHTML = `
                <div style="display: grid; gap: 20px;">
                    <!-- Resumen General -->
                    <div class="stats-section">
                        <h3><i class="fas fa-trophy"></i> Resumen General</h3>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-number">${stats.totalPredictions || 0}</div>
                                <div class="stat-label">Total Predicciones</div>
                            </div>
                            <div class="stat-card success">
                                <div class="stat-number">${stats.correctAnimals || 0}</div>
                                <div class="stat-label">Animales Acertados</div>
                            </div>
                            <div class="stat-card success">
                                <div class="stat-number">${stats.correctColors || 0}</div>
                                <div class="stat-label">Colores Acertados</div>
                            </div>
                            <div class="stat-card primary">
                                <div class="stat-number">${stats.animalAccuracy ? stats.animalAccuracy.toFixed(1) : 0}%</div>
                                <div class="stat-label">Precisi√≥n Animales</div>
                            </div>
                            <div class="stat-card primary">
                                <div class="stat-number">${stats.colorAccuracy ? stats.colorAccuracy.toFixed(1) : 0}%</div>
                                <div class="stat-label">Precisi√≥n Colores</div>
                            </div>
                            <div class="stat-card warning">
                                <div class="stat-number">${stats.overallAccuracy ? stats.overallAccuracy.toFixed(1) : 0}%</div>
                                <div class="stat-label">Precisi√≥n General</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Estad√≠sticas por Per√≠odo -->
                    <div class="stats-section">
                        <h3><i class="fas fa-calendar-alt"></i> Rendimiento por Per√≠odo</h3>
                        <div class="period-stats">
                            <div class="period-card">
                                <h4>√öltimos 7 d√≠as</h4>
                                <div class="period-data">
                                    <span>Animales: ${stats.last7Days?.animalAccuracy?.toFixed(1) || 0}%</span>
                                    <span>Colores: ${stats.last7Days?.colorAccuracy?.toFixed(1) || 0}%</span>
                                    <span>Predicciones: ${stats.last7Days?.total || 0}</span>
                                </div>
                            </div>
                            <div class="period-card">
                                <h4>√öltimos 30 d√≠as</h4>
                                <div class="period-data">
                                    <span>Animales: ${stats.last30Days?.animalAccuracy?.toFixed(1) || 0}%</span>
                                    <span>Colores: ${stats.last30Days?.colorAccuracy?.toFixed(1) || 0}%</span>
                                    <span>Predicciones: ${stats.last30Days?.total || 0}</span>
                                </div>
                            </div>
                            <div class="period-card">
                                <h4>√öltimos 100</h4>
                                <div class="period-data">
                                    <span>Animales: ${stats.last100?.animalAccuracy?.toFixed(1) || 0}%</span>
                                    <span>Colores: ${stats.last100?.colorAccuracy?.toFixed(1) || 0}%</span>
                                    <span>Predicciones: ${stats.last100?.total || 0}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Top Animales Predichos -->
                    <div class="stats-section">
                        <h3><i class="fas fa-star"></i> Animales M√°s Predichos</h3>
                        <div class="top-animals">
                            ${(stats.topPredictedAnimals || []).slice(0, 10).map(animal => `
                                <div class="animal-stat-row">
                                    <span class="animal-number">${animal.number.toString().padStart(2, '0')}</span>
                                    <span class="animal-name">${animal.name}</span>
                                    <span class="animal-count">${animal.count} veces</span>
                                    <span class="animal-success">${((animal.hits || 0) / animal.count * 100).toFixed(1)}% √©xito</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <!-- An√°lisis de IA -->
                    <div class="stats-section">
                        <h3><i class="fas fa-brain"></i> Rendimiento de IA</h3>
                        <div class="ai-stats">
                            <div class="ai-component">
                                <h4>Red Neuronal</h4>
                                <div class="ai-metrics">
                                    <span>Precisi√≥n: ${stats.neuralAccuracy ? stats.neuralAccuracy.toFixed(1) : 0}%</span>
                                    <span>Contribuci√≥n: ${stats.neuralContribution ? stats.neuralContribution.toFixed(1) : 0}%</span>
                                </div>
                            </div>
                            <div class="ai-component">
                                <h4>Patrones</h4>
                                <div class="ai-metrics">
                                    <span>Precisi√≥n: ${stats.patternAccuracy ? stats.patternAccuracy.toFixed(1) : 0}%</span>
                                    <span>Contribuci√≥n: ${stats.patternContribution ? stats.patternContribution.toFixed(1) : 0}%</span>
                                </div>
                            </div>
                            <div class="ai-component">
                                <h4>Temperatura</h4>
                                <div class="ai-metrics">
                                    <span>Precisi√≥n: ${stats.temperatureAccuracy ? stats.temperatureAccuracy.toFixed(1) : 0}%</span>
                                    <span>Contribuci√≥n: ${stats.temperatureContribution ? stats.temperatureContribution.toFixed(1) : 0}%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            statsContent.innerHTML = statsHTML;
        }
        
        // Funci√≥n para cerrar el modal de estad√≠sticas
        function closeStatsModal() {
            const modal = document.getElementById('statsModal');
            modal.style.display = 'none';
        }

        // Funci√≥n para mostrar el modal de todos los animales
        function showAllAnimalsModal() {
            const modal = document.getElementById('allAnimalsModal');
            const content = document.getElementById('allAnimalsContent');
            
            // Mostrar loading
            content.innerHTML = `
                <div class="loading">
                    <i class="fas fa-spinner"></i>
                    <p>Cargando todos los animales...</p>
                </div>
            `;
            
            modal.style.display = 'block';
            
            // Cargar todos los animales
            displayAllAnimals();
        }
        
        // Funci√≥n para mostrar todos los animales
        function displayAllAnimals() {
            const content = document.getElementById('allAnimalsContent');
            
            // Usar los animales reales del mapeo global
            const animalsArray = Object.values(allAnimals).map(animal => ({
                number: animal.animal,
                name: animal.animalName,
                color: animal.color
            }));
            
            const animalsHTML = `
                <div class="all-animals-search">
                    <input type="text" id="animalSearch" placeholder="üîç Buscar animal por nombre o n√∫mero..." onkeyup="filterAnimals()">
                </div>
                
                <div class="all-animals-filters">
                    <button class="filter-btn active" onclick="filterByColor('all')">Todos</button>
                    <button class="filter-btn" onclick="filterByColor('red')">Rojos</button>
                    <button class="filter-btn" onclick="filterByColor('black')">Negros</button>
                </div>
                
                <div class="all-animals-grid" id="allAnimalsGrid">
                    ${animalsArray.map(animal => `
                        <div class="all-animal-card ${animal.color}" onclick="showAnimalModal(${animal.number}, '${animal.name}', '${animal.color}', 0)">
                            <div class="all-animal-number">${animal.number.toString().padStart(2, '0')}</div>
                            <div class="all-animal-name">${animal.name}</div>
                            <div class="all-animal-color ${animal.color}">${animal.color}</div>
                        </div>
                    `).join('')}
                </div>
            `;
            
            content.innerHTML = animalsHTML;
        }
        
        // Funci√≥n para filtrar animales por b√∫squeda
        function filterAnimals() {
            const searchTerm = document.getElementById('animalSearch').value.toLowerCase();
            const cards = document.querySelectorAll('.all-animal-card');
            
            cards.forEach(card => {
                const number = card.querySelector('.all-animal-number').textContent;
                const name = card.querySelector('.all-animal-name').textContent.toLowerCase();
                
                if (number.includes(searchTerm) || name.includes(searchTerm)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }
        
        // Funci√≥n para filtrar por color
        function filterByColor(color, element) {
            const cards = document.querySelectorAll('.all-animal-card');
            const buttons = document.querySelectorAll('.filter-btn');
            
            // Actualizar botones activos
            buttons.forEach(btn => btn.classList.remove('active'));
            if (element) element.classList.add('active');
            
            cards.forEach(card => {
                if (color === 'all' || card.classList.contains(color)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }
        
        // Funci√≥n para cerrar el modal de todos los animales
        function closeAllAnimalsModal() {
            const modal = document.getElementById('allAnimalsModal');
            modal.style.display = 'none';
        }
        
    </script>
    </body>
</html>
